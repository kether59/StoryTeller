# ğŸ” Guide d'utilisation - Extraction automatique

## Vue d'ensemble

L'extraction automatique utilise l'IA pour analyser vos manuscrits et en extraire automatiquement :
- ğŸ‘¥ **Personnages** : noms, rÃ´les, descriptions, personnalitÃ©s
- ğŸ“ **Lieux** : villes, planÃ¨tes, bÃ¢timents avec descriptions
- â° **Chronologie** : Ã©vÃ©nements clÃ©s avec dates et participants
- ğŸ“š **Lore** : Ã©lÃ©ments de world-building (magie, technologie, factions...)

## ğŸ¯ Cas d'usage

### 1. DÃ©marrer un nouveau projet depuis un texte existant
Vous avez Ã©crit quelques chapitres Ã  la main et voulez structurer votre histoire.

### 2. Enrichir une histoire existante
Vous avez dÃ©jÃ  des personnages mais voulez extraire plus de dÃ©tails depuis vos chapitres.

### 3. VÃ©rifier la cohÃ©rence
Comparez ce que l'IA extrait avec vos fiches existantes pour dÃ©tecter des incohÃ©rences.

---

## ğŸ“– Mode d'emploi

### Ã‰tape 1 : PrÃ©parer le manuscrit

1. Allez dans l'onglet **"Manuscrit"**
2. CrÃ©ez ou sÃ©lectionnez un chapitre existant
3. Assurez-vous qu'il contient au moins **500 mots** (l'IA a besoin de contexte)

**Conseil :** Plus le texte est long et dÃ©taillÃ©, meilleurs seront les rÃ©sultats.

---

### Ã‰tape 2 : Lancer l'extraction

1. Allez dans l'onglet **"ğŸ” Extraction"**
2. SÃ©lectionnez le manuscrit Ã  analyser
3. Cochez les types d'Ã©lÃ©ments Ã  extraire :
    - âœ… Personnages
    - âœ… Lieux
    - âœ… Chronologie
    - âœ… Lore
4. Cliquez sur **"ğŸš€ Lancer l'extraction"**
5. Attendez 30-90 secondes (selon la longueur du texte)

---

### Ã‰tape 3 : Valider les rÃ©sultats

L'IA vous prÃ©sente tous les Ã©lÃ©ments trouvÃ©s. Pour chaque Ã©lÃ©ment :

#### âœ… Ã‰lÃ©ments prÃ©-approuvÃ©s
Les Ã©lÃ©ments avec **confiance > 70%** sont automatiquement cochÃ©s (mais vous pouvez les dÃ©cocher).

#### ğŸ”§ Modification
Vous pouvez modifier directement :
- Les noms
- Les descriptions
- Les rÃ´les
- Tous les champs

#### âŒ Rejet
DÃ©cochez les Ã©lÃ©ments incorrects ou non pertinents.

---

### Ã‰tape 4 : CrÃ©ation des entrÃ©es

1. VÃ©rifiez le rÃ©sumÃ© en haut :
    - ğŸ‘¥ X/Y Personnages
    - ğŸ“ X/Y Lieux
    - â° X/Y Ã‰vÃ©nements
    - ğŸ“š X/Y Lore

2. Cliquez sur **"âœ… Valider et crÃ©er les entrÃ©es"**

3. Le systÃ¨me crÃ©e les entrÃ©es dans cet ordre :
    - **1er** : Personnages
    - **2e** : Lieux
    - **3e** : Lore
    - **4e** : Chronologie (nÃ©cessite les personnages/lieux existants)

4. Un message de confirmation s'affiche avec le nombre d'Ã©lÃ©ments crÃ©Ã©s

---

## ğŸ’¡ Conseils pour de meilleurs rÃ©sultats

### âœ… Bonnes pratiques

**1. Texte clair et structurÃ©**
```
Mauvais : "Il arriva lÃ  et vit le truc"
Bon : "Jean-Marc arriva Ã  Paris et dÃ©couvrit la Tour Eiffel"
```

**2. Mentions explicites**
```
Mauvais : "Elle Ã©tait grande"
Bon : "Marie, la protagoniste, Ã©tait grande et avait les cheveux roux"
```

**3. Contexte pour les lieux**
```
Mauvais : "Dans la ville"
Bon : "Ã€ Londres, capitale brumeuse de l'Angleterre victorienne"
```

**4. Dates claires pour la chronologie**
```
Mauvais : "AprÃ¨s quelques jours"
Bon : "Le 15 mars 2024, trois jours aprÃ¨s leur premiÃ¨re rencontre"
```

### âŒ PiÃ¨ges Ã  Ã©viter

1. **Texte trop court** : < 500 mots â†’ pas assez de contexte
2. **Trop de pronoms** : "Il", "elle", "lui" sans rappel des noms
3. **Descriptions implicites** : L'IA ne peut pas deviner ce qui n'est pas Ã©crit
4. **Orthographe approximative** : L'IA peut mal interprÃ©ter les noms

---

## ğŸ”„ Workflow recommandÃ©

### Pour un nouveau projet

```
1. Ã‰crire 2-3 chapitres (3000-5000 mots minimum)
2. Lancer l'extraction sur le premier chapitre
3. Valider et crÃ©er les personnages/lieux principaux
4. Lancer l'extraction sur le deuxiÃ¨me chapitre
5. VÃ©rifier les doublons (l'IA dÃ©tecte les personnages existants)
6. ComplÃ©ter manuellement les fiches crÃ©Ã©es
```

### Pour enrichir un projet existant

```
1. Avoir dÃ©jÃ  des personnages/lieux de base
2. Ã‰crire un nouveau chapitre
3. Lancer l'extraction pour trouver de nouveaux Ã©lÃ©ments
4. Comparer avec vos fiches existantes
5. Ajouter uniquement les nouveaux Ã©lÃ©ments ou dÃ©tails manquants
```

---

## ğŸ¨ Exemples de rÃ©sultats

### Exemple 1 : Personnage dÃ©tectÃ©

**Texte original :**
> "Elara Vancian, une jeune marchande de 25 ans aux cheveux chÃ¢tains, Ã©tait connue pour son caractÃ¨re sceptique. MalgrÃ© sa loyautÃ©, elle craignait profondÃ©ment l'autoritÃ© de l'Ordre Immuable."

**Extraction :**
```json
{
  "name": "Vancian",
  "surname": "Elara",
  "role": "Protagoniste",
  "age": 25,
  "physical_description": "Cheveux chÃ¢tains",
  "personality": "Sceptique, loyale, craint l'autoritÃ©",
  "confidence": 0.95
}
```

### Exemple 2 : Lieu dÃ©tectÃ©

**Texte original :**
> "Le Bazar des Ã‰chos, un marchÃ© souterrain illÃ©gal nichÃ© sous les rues d'Aethel, Ã©tait le lieu de prÃ©dilection des marchands de souvenirs."

**Extraction :**
```json
{
  "name": "Le Bazar des Ã‰chos",
  "type": "MarchÃ© Noir",
  "summary": "MarchÃ© souterrain illÃ©gal sous Aethel oÃ¹ l'on vend des souvenirs",
  "confidence": 0.88
}
```

### Exemple 3 : Ã‰vÃ©nement chronologique

**Texte original :**
> "Le 3 janvier 2024, Elara et Kellan s'affrontÃ¨rent dans les rues brumeuses d'Aethel. Cette course-poursuite changea le destin de la citÃ©."

**Extraction :**
```json
{
  "title": "Course-poursuite Ã  Aethel",
  "date": "2024-01-03",
  "summary": "Affrontement entre Elara et Kellan qui changea le destin de la citÃ©",
  "character_names": ["Elara", "Kellan"],
  "location_name": "Aethel",
  "sort_order": 2,
  "confidence": 0.92
}
```

---

## ğŸ› DÃ©pannage

### "Manuscrit trop court pour Ãªtre analysÃ©"
â†’ Votre texte fait moins de 100 caractÃ¨res. Ã‰crivez au moins 500 mots.

### "Aucun personnage trouvÃ©"
â†’ L'IA n'a pas dÃ©tectÃ© de noms clairs. Utilisez des noms propres explicites.

### "Confiance trÃ¨s faible (< 0.5)"
â†’ L'IA n'est pas sÃ»re. VÃ©rifiez attentivement avant de valider.

### "Doublon dÃ©tectÃ©"
â†’ Un Ã©lÃ©ment similaire existe dÃ©jÃ . Normal, l'IA ne crÃ©era pas de doublon.

### "Erreur lors de l'extraction"
â†’ VÃ©rifiez que votre clÃ© API LLM est configurÃ©e dans `.env`

---

## âš™ï¸ Configuration avancÃ©e

### Ajuster la sensibilitÃ©

Dans `routes/extraction.py`, vous pouvez modifier les prompts pour :

```python
# Plus strict (moins d'Ã©lÃ©ments, plus de confiance)
system_prompt = """Tu es trÃ¨s strict. 
N'extrait que les Ã©lÃ©ments dont tu es ABSOLUMENT certain."""

# Plus permissif (plus d'Ã©lÃ©ments, confiance variable)
system_prompt = """Tu es permissif. 
Extrait mÃªme les Ã©lÃ©ments dont tu n'es pas totalement certain."""
```

### Limiter la longueur analysÃ©e

```python
# Dans analyze_manuscript()
manuscript.text[:8000]  # Analyser seulement 8000 caractÃ¨res
manuscript.text[:20000] # Analyser 20000 caractÃ¨res
```

**Note :** Plus de texte = meilleure qualitÃ© mais coÃ»t API plus Ã©levÃ© et temps plus long.

---

## ğŸ’° CoÃ»t estimÃ©

**Avec Anthropic Claude :**
- Extraction de 5000 mots : ~$0.10-0.20
- Extraction de 10000 mots : ~$0.20-0.40

**Avec OpenAI GPT-4 :**
- Similaire ou lÃ©gÃ¨rement plus cher

**Avec Ollama (local) :**
- Gratuit, mais plus lent sans GPU

---

## ğŸš€ FonctionnalitÃ©s futures

- [ ] Extraction depuis PDF/DOCX
- [ ] DÃ©tection automatique des relations entre personnages
- [ ] GÃ©nÃ©ration d'une frise chronologique visuelle
- [ ] Export des fiches en PDF
- [ ] DÃ©tection de personnages secondaires vs principaux
- [ ] Analyse de l'arc narratif des personnages

---

## ğŸ“ Questions frÃ©quentes

**Q : Puis-je extraire depuis plusieurs chapitres Ã  la fois ?**
R : Actuellement non, mais vous pouvez lancer l'extraction plusieurs fois. Les doublons sont automatiquement dÃ©tectÃ©s.

**Q : L'extraction modifie-t-elle mes manuscrits ?**
R : Non, l'extraction est en lecture seule. Vos textes ne sont jamais modifiÃ©s.

**Q : Puis-je annuler la crÃ©ation aprÃ¨s validation ?**
R : Non. Une fois crÃ©Ã©s, vous devrez supprimer manuellement les Ã©lÃ©ments indÃ©sirables.

**Q : L'IA peut-elle extraire des dialogues ?**
R : Elle dÃ©tecte les personnages mentionnÃ©s dans les dialogues, mais n'extrait pas les dialogues eux-mÃªmes (ils restent dans le manuscrit).

**Q : Comment amÃ©liorer la dÃ©tection ?**
R : Soyez explicite dans votre Ã©criture. Mentionnez rÃ©guliÃ¨rement les noms complets, dÃ©crivez clairement les lieux, et indiquez les dates.

---

**Bonne extraction ! ğŸ”âœ¨**